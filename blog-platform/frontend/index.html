<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Go Blog</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
        }
        h1 {
            margin-bottom: 10px;
        }
        form {
            margin-bottom: 30px;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }
        button {
            padding: 8px 16px;
            cursor: pointer;
        }
        .post {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
        .status {
            margin-bottom: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h1>Simple Blog</h1>

<div class="status" id="status">Checking API...</div>

<h2>Create Post</h2>

<form id="postForm">
    <input type="text" id="title" placeholder="Title" required />
    <textarea id="text" placeholder="Text" rows="4" required></textarea>
    <button type="submit">Create</button>
</form>

<h2>Posts</h2>
<div id="posts"></div>

<script>
const API_BASE = "http://localhost:8080";
// If API is behind same Ingress, leave empty.
// If different service, set like: "http://api-service:8080"

async function checkHealth() {
    try {
        const res = await fetch(`${API_BASE}/health`);
        if (res.ok) {
            document.getElementById("status").innerText = "API is healthy";
        } else {
            document.getElementById("status").innerText = "API is unhealthy";
        }
    } catch (err) {
        document.getElementById("status").innerText = "API unreachable";
    }
}

async function loadPosts() {
    const res = await fetch(`${API_BASE}/posts`);
    const data = await res.json();

    const container = document.getElementById("posts");
    container.innerHTML = "";

    data.forEach(post => {
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `
            <strong>Title: ${post.title}</strong>
            <p>Text: ${post.text}</p>
            <p>Processed: ${post.processed}</p>
        `;
        container.appendChild(div);
    });
}

document.getElementById("postForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const title = document.getElementById("title").value;
    const text = document.getElementById("text").value;

    await fetch(`${API_BASE}/posts`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ title, text })
    });

    document.getElementById("title").value = "";
    document.getElementById("text").value = "";

    loadPosts();
});

setTimeout(() => {
  loadPosts();
}, 5000)

checkHealth();
loadPosts();
</script>

</body>
</html>
